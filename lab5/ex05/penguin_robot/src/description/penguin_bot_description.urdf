<?xml version="1.0"?>
<robot name="penguin_bot" xmlns:xacro="http://ros.org/wiki/xacro">

<xacro:property name="base_length" value="0.36"/>
<xacro:property name="base_width" value="0.16"/>
<xacro:property name="base_height" value="0.1"/>

<xacro:property name="wheel_radius" value="0.016"/>
<xacro:property name="wheel_height" value="0.01"/>

<xacro:property name="head_radius" value="0.05"/>

<xacro:property name="beak_length" value="0.05"/>
<xacro:property name="beak_width" value="0.01"/>
<xacro:property name="beak_height" value="0.01"/>

<xacro:property name="eye_radius" value="0.008"/>

<xacro:property name="foot_length" value="0.015"/>
<xacro:property name="foot_width" value="0.04"/>
<xacro:property name="foot_height" value="0.05"/>

<xacro:property name="wing_length" value="0.2"/>
<xacro:property name="wing_width" value="0.02"/>
<xacro:property name="wing_height" value="0.08"/>

<xacro:property name="tail_length" value="0.06"/>
<xacro:property name="tail_width" value="0.045"/>
<xacro:property name="tail_height" value="0.01"/>

<xacro:property name="rpg_base_length" value="0.25"/>
<xacro:property name="rpg_base_width" value="0.025"/>
<xacro:property name="rpg_base_height" value="0.025"/>

<xacro:property name="rpg_side_length" value="0.03"/>
<xacro:property name="rpg_side_width" value="0.03"/>
<xacro:property name="rpg_side_height" value="0.03"/>

<!-- Macros -->
<!-- Wheel macro -->
<xacro:macro name="wheel" params="prefix y_reflect">
    <link name="${prefix}_wheel">
        <visual>
            <geometry>
                <cylinder radius="${wheel_radius}" length="${wheel_height}"/>
            </geometry>
            <material name="black">
                <color rgba="0.1 0.1 0.1 1.0"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <cylinder radius="${wheel_radius}" length="${wheel_height}"/>
            </geometry>
        </collision>
        <inertial>
            <mass value="0.05"/>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="0.000007" ixy="0.0" ixz="0.0"
                     iyy="0.000007" iyz="0.0"
                     izz="0.000007"/>
        </inertial>
    </link>

    <joint name="${prefix}_wheel_joint" type="continuous">
        <parent link="base_link"/>
        <child link="${prefix}_wheel"/>
        <origin xyz="0.12 ${y_reflect*0.085} ${wheel_radius}" rpy="1.57079633 0 0"/>
        <axis xyz="0 0 1"/>
        <limit effort="10000.0" velocity="10000.0"/>
        <dynamics damping="0.001" friction="0.001"/>
    </joint>
</xacro:macro>

<!-- Eye macro -->
<xacro:macro name="eye" params="prefix y_reflect">
    <link name="${prefix}_eye">
        <visual>
            <geometry>
                <sphere radius="${eye_radius}"/>
            </geometry>
            <material name="white">
                <color rgba="1.0 1.0 1.0 1"/>
            </material>
        </visual>
        <inertial>
            <mass value="0.001"/>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="0.00000003" ixy="0.0" ixz="0.0"
                     iyy="0.00000003" iyz="0.0"
                     izz="0.00000003"/>
        </inertial>
    </link>

    <joint name="${prefix}_eye_joint" type="fixed">
        <parent link="head"/>
        <child link="${prefix}_eye"/>
        <origin xyz="-0.04 ${y_reflect*0.02} 0.02" rpy="0.0 0.0 0.0"/>    
    </joint>
</xacro:macro>

<!-- Foot macro -->
<xacro:macro name="foot" params="prefix y_reflect">
    <link name="${prefix}_foot">
        <visual>
            <geometry>
                <box size="${foot_length} ${foot_width} ${foot_height}"/>
            </geometry>
            <material name="orange">
                <color rgba="1.0 0.6 0.0 1.0"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <box size="${foot_length} ${foot_width} ${foot_height}"/>
            </geometry>
        </collision>
        <inertial>
            <mass value="0.02"/>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="0.000002" ixy="0.0" ixz="0.0"
                     iyy="0.0000004" iyz="0.0"
                     izz="0.000002"/>
        </inertial>
    </link>

    <joint name="${prefix}_foot_joint" type="fixed">
        <parent link="base_link"/>
        <child link="${prefix}_foot"/>
        <origin xyz="0.185 ${y_reflect*0.05} 0.058" rpy="0.0 0.0 0.0"/>   
    </joint>
</xacro:macro>

<!-- Wing macro -->
<xacro:macro name="wing" params="prefix y_reflect">
    <link name="${prefix}_wing">
        <visual>
            <geometry>
                <box size="${wing_length} ${wing_width} ${wing_height}"/>
            </geometry>
            <material name="black">
                <color rgba="0.1 0.1 0.1 1.0"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <box size="${wing_length} ${wing_width} ${wing_height}"/>
            </geometry>
        </collision>
        <inertial>
            <mass value="0.1"/>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="0.00006" ixy="0.0" ixz="0.0"
                     iyy="0.00034" iyz="0.0"
                     izz="0.00034"/>
        </inertial>
    </link>

    <joint name="${prefix}_wing_joint" type="fixed">
        <parent link="base_link"/>
        <child link="${prefix}_wing"/>
        <origin xyz="0.0 ${y_reflect*0.09} 0.058" rpy="0.0 0.0 0.0"/>   
    </joint>
</xacro:macro>

<!-- Robot base(torso) -->
<link name="base_link">
    <visual>
        <origin xyz="0.0 0.0 0.058" rpy="0.0 0.0 0.0"/>
        <geometry>
            <box size="${base_length} ${base_width} ${base_height}"/>
        </geometry>
        <material name="black">
            <color rgba="0.1 0.1 0.1 1.0"/>
        </material>
    </visual>
    <collision>
        <origin xyz="0.0 0.0 0.058" rpy="0.0 0.0 0.0"/>
        <geometry>
            <box size="${base_length} ${base_width} ${base_height}"/>
        </geometry>
    </collision>
    <inertial>
        <mass value="1.5"/>
        <origin xyz="0.0 0.0 0.058" rpy="0.0 0.0 0.0"/>
        <inertia ixx="0.0135" ixy="0.0" ixz="0.0"
                 iyy="0.0178" iyz="0.0"
                 izz="0.0086"/>
    </inertial>
</link>

<!-- Front Caster -->
<link name="caster">
    <visual>
        <geometry>
            <sphere radius="${wheel_radius}"/>
        </geometry>
        <material name="black">
            <color rgba="0.1 0.1 0.1 1.0"/>
        </material>
    </visual>
    <collision>
        <geometry>
            <sphere radius="${wheel_radius}"/>
        </geometry>
    </collision>
    <inertial>
        <mass value="0.03"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="0.00000006" ixy="0.0" ixz="0.0"
                 iyy="0.00000006" iyz="0.0"
                 izz="0.00000006"/>
    </inertial>
</link>

<link name="head">
    <visual>
        <geometry>
            <sphere radius="${head_radius}"/>
        </geometry>
        <material name="black">
            <color rgba="0.1 0.1 0.1 1.0"/>
        </material>
    </visual>
    <collision>
        <geometry>
            <sphere radius="${head_radius}"/>
        </geometry>
    </collision>
    <inertial>
        <mass value="0.3"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="0.0003" ixy="0.0" ixz="0.0"
                 iyy="0.0003" iyz="0.0"
                 izz="0.0003"/>
    </inertial>
</link>

<link name="beak">
    <visual>
        <geometry>
            <box size="${beak_length} ${beak_width} ${beak_height}"/>
        </geometry>
        <material name="orange">
            <color rgba="1.0 0.6 0.0 1.0"/>
        </material>
    </visual>
    <collision>
        <geometry>
            <box size="${beak_length} ${beak_width} ${beak_height}"/>
        </geometry>
    </collision>
    <inertial>
        <mass value="0.005"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="0.00000002" ixy="0.0" ixz="0.0"
                 iyy="0.00000001" iyz="0.0"
                 izz="0.00000001"/>
    </inertial>
</link>

<link name="tail">
    <visual>
        <geometry>
            <box size="${tail_length} ${tail_width} ${tail_height}"/>
        </geometry>
        <material name="black">
            <color rgba="0.1 0.1 0.1 1.0"/>
        </material>
    </visual>
    <collision>
        <geometry>
            <box size="${tail_length} ${tail_width} ${tail_height}"/>
        </geometry>
    </collision>
    <inertial>
        <mass value="0.05"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="0.000008" ixy="0.0" ixz="0.0"
                 iyy="0.000002" iyz="0.0"
                 izz="0.00001"/>
    </inertial>
</link>

<link name="rpg_base">
    <visual>
        <geometry>
            <box size="${rpg_base_length} ${rpg_base_width} ${rpg_base_height}"/>
        </geometry>
        <material name="green">
            <color rgba="0.05 0.2 0.0 1.0"/>
        </material>
    </visual>
    <collision>
        <geometry>
            <box size="${rpg_base_length} ${rpg_base_width} ${rpg_base_height}"/>
        </geometry>
    </collision>
    <inertial>
        <mass value="0.15"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="0.00001" ixy="0.0" ixz="0.0"
                 iyy="0.00008" iyz="0.0"
                 izz="0.00008"/>
    </inertial>
</link>

<link name="rpg_front">
    <visual>
        <geometry>
            <box size="${rpg_side_length} ${rpg_side_width} ${rpg_side_height}"/>
        </geometry>
        <material name="green">
            <color rgba="0.05 0.2 0.0 1.0"/>
        </material>
    </visual>
    <collision>
        <geometry>
            <box size="${rpg_side_length} ${rpg_side_width} ${rpg_side_height}"/>
        </geometry>
    </collision>
    <inertial>
        <mass value="0.08"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="0.000006" ixy="0.0" ixz="0.0"
                 iyy="0.000006" iyz="0.0"
                 izz="0.000006"/>
    </inertial>
</link>

<!-- Joints -->
<!-- Using wheel macros -->
<xacro:wheel prefix="left" y_reflect="1" />
<xacro:wheel prefix="right" y_reflect="-1" />

<joint name="caster_joint" type="fixed">
    <parent link="base_link"/>
    <child link="caster"/>
    <origin xyz="-0.12 0.0 0.016" rpy="0.0 0.0 0.0"/>    
</joint>

<gazebo reference="caster">
    <mu1>0.0001</mu1>
    <mu2>0.0001</mu2>
</gazebo>

<joint name="head_joint" type="fixed">
    <parent link="base_link"/>
    <child link="head"/>
    <origin xyz="-0.2 0.0 0.058" rpy="0.0 0.0 0.0"/>    
</joint>

<joint name="beak_joint" type="fixed">
    <parent link="head"/>
    <child link="beak"/>
    <origin xyz="-0.05 0.0 0.0" rpy="0.0 0.0 0.0"/>    
</joint>

<!-- Using eye macros -->
<xacro:eye prefix="left" y_reflect="1" />
<xacro:eye prefix="right" y_reflect="-1" />

<!-- Using foot macros -->
<xacro:foot prefix="left" y_reflect="1" />
<xacro:foot prefix="right" y_reflect="-1" />

<!-- Using wing macros -->
<xacro:wing prefix="left" y_reflect="1" />
<xacro:wing prefix="right" y_reflect="-1" />

<joint name="tail_joint" type="fixed">
    <parent link="base_link"/>
    <child link="tail"/>
    <origin xyz="0.2 0.0 0.103" rpy="0.0 0.0 0.0"/>   
</joint>

<joint name="rpg_joint" type="fixed">
    <parent link="base_link"/>
    <child link="rpg_base"/>
    <origin xyz="0.0 0.0 0.123" rpy="0.0 0.0 0.785398"/>   
</joint>

<joint name="rpg_front_joint" type="fixed">
    <parent link="rpg_base"/>
    <child link="rpg_front"/>
    <origin xyz="-0.125 0.0 0.0" rpy="0.0 0.0 0.0"/>   
</joint>

<gazebo>
    <plugin
      filename="gz-sim-diff-drive-system"
      name="gz::sim::systems::DiffDrive">
      <left_joint>left_wheel_joint</left_joint>
      <right_joint>right_wheel_joint</right_joint>
      <wheel_separation>0.17</wheel_separation>
      <wheel_radius>0.016</wheel_radius>
      <odom_publish_frequency>50</odom_publish_frequency>
      <topic>cmd_vel</topic>
      <odom_topic>odom</odom_topic>
      <frame_id>odom</frame_id>
      <child_frame_id>base_link</child_frame_id>
    </plugin>
    <plugin
        filename="gz-sim-joint-state-publisher-system"
        name="gz::sim::systems::JointStatePublisher">
        <topic>joint_states</topic>
        <joint_name>left_wheel_joint</joint_name>
        <joint_name>right_wheel_joint</joint_name>
    </plugin>
</gazebo>

</robot>